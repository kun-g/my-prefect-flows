# ADR 写作规范

## 什么是 ADR

ADR (Architecture Decision Record) 是架构决策记录，用于记录项目中的重要架构决策。其核心目的是回答"为什么这样做"，为团队提供决策的历史背景和思考过程。

## 为什么要写 ADR

1. **记录决策背景**：帮助团队理解为什么做出某个决策
2. **避免重复讨论**：避免同样的问题被反复讨论
3. **知识传承**：新成员可以快速了解项目的技术演进
4. **决策追溯**：当决策出现问题时，可以追溯原因
5. **经验积累**：为后续类似决策提供参考

## ADR 的标准格式

### 基本结构

```markdown
# ADR-XXX: 决策标题

## 状态
[提议中 | 已接受 | 已实现 | 已废弃 | 被替代]

## 背景
描述需要做决策的问题和上下文

## 决策
我们决定采用什么方案，包括技术选型

## 替代方案
考虑过但没有采用的其他方案，以及为什么不选择

## 后果
这个决策带来的影响（正面和负面）

## 实施结果 (可选)
实际实施后的效果和经验教训

## 相关文档
相关的 ADR、文档或资源链接
```

### 状态说明

- **提议中 (Proposed)**：决策正在讨论中
- **已接受 (Accepted)**：决策已被团队接受
- **已实现 (Implemented)**：决策已经实施完成
- **已废弃 (Deprecated)**：决策已过时或不再使用
- **被替代 (Superseded)**：被新的 ADR 替代

## 写作原则

### ✅ 应该包含的内容

1. **架构决策**：影响系统架构的重要决策
2. **技术选型**：选择某个技术栈、框架或库的决策
3. **设计原则**：系统设计的指导原则
4. **约束条件**：技术或业务约束对决策的影响
5. **权衡分析**：不同方案的优劣对比
6. **实施验证**：决策实施后的效果验证

### ❌ 不应该包含的内容

1. **详细的实施计划**：Phase 1-5 这种项目管理内容
2. **具体的安装步骤**：`pip install xxx` 这种操作细节
3. **完整的代码示例**：超过必要的代码
4. **API 使用文档**：详细的 API 调用方式
5. **配置文件模板**：完整的配置文件内容
6. **故障排除指南**：具体的问题解决方法

## 写作技巧

### 1. 标题命名

- 使用动词短语：`采用 LiteLLM 作为 LLM 抽象层`
- 避免技术术语：`实现智能内容分析系统` 而不是 `实现 NLP Pipeline`
- 保持简洁：不超过 10 个字

### 2. 背景描述

- 从具体问题出发
- 描述当前状况的不足
- 说明为什么需要做这个决策

### 3. 决策内容

- 明确说明选择了什么方案
- 包含关键的技术选型
- 说明核心的设计原则

### 4. 替代方案

- 列出 2-3 个主要的替代方案
- 简要说明为什么不选择
- 避免过于详细的技术对比

### 5. 后果分析

- 分别列出正面和负面影响
- 包含对团队、系统、用户的影响
- 提及可能的技术债务

## 文档管理

### 编号规则

- 使用三位数字编号：ADR-001, ADR-002, ADR-003
- 按时间顺序递增
- 不要跳号或复用编号

### 版本控制

- ADR 文件应该纳入版本控制
- 重要修改应该通过 PR 进行评审
- 保留历史版本，不要删除已废弃的 ADR

## 配套工具

### ADR 与其他文档的关系

| 文档类型 | 用途 | 示例内容 |
|---------|------|----------|
| ADR | 架构决策记录 | 为什么选择 Redis 而不是 MongoDB |
| README | 项目介绍和快速开始 | 如何安装和运行项目 |
| 技术文档 | 详细的使用指南 | API 文档、配置说明 |
| 代码注释 | 具体实现细节 | 函数作用、复杂逻辑说明 |
| 项目管理工具 | 实施计划和进度 | JIRA、GitHub Issues |

### 工具组合建议

1. **重要决策** → ADR 记录
2. **实施细节** → 技术文档或代码注释
3. **使用指南** → README 或 Wiki
4. **项目进度** → 项目管理工具
5. **问题追踪** → Issue 管理系统

## 最佳实践

### 1. 及时更新

- 当实际实施与 ADR 设计有偏差时，及时更新 ADR
- 在"实施结果"部分记录实际效果
- 说明偏差的原因和经验教训

### 2. 团队协作

- 重要 ADR 应该经过团队讨论
- 通过 PR 进行评审和讨论
- 新成员入职时应该阅读相关 ADR

### 3. 保持简洁

- 单个 ADR 不要超过 2 页
- 专注于决策本身，而不是实施细节
- 使用清晰的标题和结构

### 4. 定期回顾

- 定期检查 ADR 的有效性
- 更新过时的决策状态
- 总结经验教训

## 示例模板

```markdown
# ADR-001: 采用 FastAPI 作为 Web 框架

## 状态
已实现 (Implemented)

## 背景
项目需要构建 RESTful API，要求：
1. 高性能，支持异步处理
2. 自动生成 API 文档
3. 类型检查支持
4. 生态系统完善

## 决策
我们决定采用 FastAPI 作为 Web 框架，原因：
1. 原生支持异步 I/O
2. 基于 Pydantic 提供类型检查
3. 自动生成 OpenAPI 文档
4. 社区活跃，生态完善

## 替代方案
- **Django REST framework**：功能完整但性能较低
- **Flask**：轻量级但缺少类型检查
- **Tornado**：异步支持但学习成本高

## 后果
### 正面影响
- 开发效率提高 30%
- API 文档自动生成
- 类型错误在开发期发现

### 负面影响
- 团队需要学习新框架
- 依赖 Python 3.7+

## 实施结果
经过 3 个月使用，效果良好：
- API 响应时间平均减少 40%
- 类型相关 bug 减少 80%
- 文档维护工作量减少 60%

## 相关文档
- [FastAPI 官方文档](https://fastapi.tiangolo.com/)
- [项目 API 设计指南](../api-design.md)
```

## 总结

ADR 是记录**关键决策**的工具，重点是**为什么**而不是**怎么做**。通过与其他文档工具的合理组合，可以构建完整的项目知识体系，为团队协作和知识传承提供有力支撑。

记住：**关键信息要有记录，工具可以灵活组合**。

判断标准：**写下来的时间 ≤ 再次思考同一问题所耗时间。**