个人项目决策记录规范 v1.0

适用范围：单人或 1–2 人的小型项目仓库
不含 ADR 写作细节（假设你已拥有 ADR 模板）；重点定义 何时、何处、如何 记录决策，以及持续治理流程。

⸻

1 术语与概念

术语	定义	主要用途
微决策（Decision）	对代码、依赖、流程等作出的局部、可逆选择	便于个人快速回忆
架构决策（ADR）	跨模块、长生命周期、高代价或高风险的决策	系统级追溯与团队沟通
DEC 条目	DECISIONS.md 中的一段微决策记录	轻量、集中
Refs 标记	提交信息中的 Refs: DEC-... 或 Refs: ADR-...	建立代码 ↔ 决策索引


⸻

2 目录与文件

/project-root
├─ DECISIONS.md            # 微决策集中记录（单文件）
└─ docs/
   └─ adr/                 # 架构决策目录
      ├─ 001-use-sqlite.md
      └─ 002-...

	•	禁止 把 DEC 条目拆成多文件；保持单一入口。
	•	ADR 文件按三位序号前缀 + 短横线标题，放在 docs/adr/ 下。

⸻

3 分级判定与触发条件

3.1 自检清单（4 项）
	1.	影响范围 ≥ 2 个模块/服务
	2.	生命周期 ≥ 6 个月
	3.	回滚代价 ≥ 1 人日
	4.	风险/依赖 涉及外部计费、安全、合规或性能 SLA

	•	命中 ≥ 2 → 写 ADR
	•	否则 → 写 DEC 条目

3.2 写 DEC 条目的最低触发
	•	思考时间 ≥ 30 分钟，或
	•	预计影响 ≥ 3 个月，或
	•	回滚/重构代价 ≥ 5 小时

⸻

4 模板

4.1 DEC 条目

### 2025-07-15 使用 SQLite 作为本地缓存
- **Decision**: JSON → SQLite (WAL)
- **Reason**: O(N²) 查询瓶颈 + 写冲突
- **Alternatives**: JSON + 内存索引 / Postgres
- **Trade-offs**: 引入 schema 迁移；云端迁移脚本

总行数 ≤ 12；可选字段可省略，但 Decision 与 Reason 必填。

4.2 ADR（引用现有规范）

保留 Status / Context / Decision / Consequences / Alternatives / Supersedes 等完整段落，命名 NNN-title.md。

⸻

5 提交与关联
	1.	代码与文档同一个 commit / PR
	2.	Commit message 结构示例：

feat(cache): switch to SQLite  (#45)

Refs: DEC-20250715-sqlite

	•	DEC-YYYYMMDD-keyword 或 ADR-NNN 便于 git log --grep 检索
	•	若已关联 Issue，可同时 closes #123，两者不冲突

⸻

6 维护策略

场景	DEC 条目操作	ADR 文件操作
失效 / 废弃	末尾追加 — ⚠ Deprecated YYYY-MM-DD	Status 改为 Deprecated
内容膨胀（> 12 行或补丁 ≥ 2 次）	写新 ADR，旧条目尾加 Superseded by ADR-NNN	新文件 Status: Accepted
同主题条目 ≥ 3	合并为 ADR，旧条目标 Merged	统一记录权衡

原则：正文只增不改，保持时间线完整。

⸻

7 最小流程（闭环）

步骤	动作	产出
1 触发	Issue / TODO / 新需求	草稿
2 判定	4 项清单 + 最低触发	DEC 或 ADR
3 记录	填模板（DEC 追加，ADR 新文件）	文档
4 提交	同步代码，写 Refs:	Commit / PR
5 评审*	ChatGPT 自检或同伴 Review	评论
6 维护	季度回顾：失效标记/升级	标签更新

* 个人项目可选。若无同伴，用 AI 快速交叉检查是否遗漏替代方案与负面影响。

⸻

8 自动化建议

目标	工具	说明
快速新建 ADR	adr-tools	adr new <title>
快速插入 DEC	Shell alias dec	自动写日期模板
提交前提醒	Git pre-commit	代码变更但缺失决策记录时警告
跨文件搜索	ripgrep DEC-	离线快速检索
可视化回顾	Obsidian Dataview / MkDocs	自动聚合决策索引


⸻

9 版本管理
	•	本规范采用 SemVer，从 v1.0.0 起。
	•	对本规范的任何修改，自身也需遵循本规范：新增/修改部分以 DEC/ADR 记录。
	•	发布流程：合并 main 后自动更新公开文档站点（可选）。

⸻

✅ 关键要点回顾
	1.	一条清单 + 二分阈值：4 问题命中 ≥ 2 → ADR，否则 DEC。
	2.	DEC：单文件、≤ 12 行、先写后做；正文只增不改。
	3.	Refs 标记：确保代码 ↔ 决策永不失链，Issue 体系变化也安全。
	4.	季度回顾：失效标记、膨胀升级，保证文档始终“活着”。
	5.	自动化：只做“提醒你写、帮你找回”两件事，避免流程过重。

按此规范执行，可在最小投入下获得可追溯、可演进的个人项目决策体系。