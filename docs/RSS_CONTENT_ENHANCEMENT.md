# RSS 内容增强指南

本指南说明了为 RSS 订阅源生成系统实现的新内容提取和"阅读更多..."链接功能。

## 新增功能

### 🔗 阅读更多链接
每个 RSS 条目现在都包含一个"阅读更多..."链接，引导读者访问您网站上的原始文章。这有助于为您的网站导流，同时在 RSS 阅读器中提供内容预览。

### 📄 内容提取
系统现在可以从文章页面提取实际内容，而不仅仅是使用元描述，为 RSS 订阅源提供更丰富的内容摘录。

### 🎨 HTML 支持
RSS 描述现在通过 CDATA 部分正确支持 HTML 格式，允许在现代 RSS 阅读器中显示丰富的内容。

## 配置

### 启用内容提取

内容提取功能默认已启用（`extract_content: true`）。您无需修改配置文件，系统将自动提取所有可用的文章内容。

### 配置选项

- `extract_content`: 设置为 `true` 启用内容提取（默认值：`true`）
- `fetch_titles`: 是否获取页面标题（现有功能）

## 工作原理

### 内容提取过程

1. **页面获取**: 从每个 URL 下载 HTML 内容
2. **内容检测**: 使用语义选择器识别主要内容区域：
   - `<article>` 元素
   - `[role="main"]` 
   - `.content`, `.main-content`, `.post-content` 类
   - 回退到 `<main>` 或 `<body>`
3. **内容过滤**: 移除不需要的元素：
   - 导航、页眉、页脚
   - 侧边栏和广告  
   - 脚本和样式
4. **文本提取**: 提取所有段落内容
5. **链接添加**: 在末尾添加"阅读更多..."链接到原始 URL

### 后备行为

如果内容提取失败或找不到合适的内容：
- 回退到元描述
- 如果没有元描述，创建简单的"阅读更多..."链接
- 确保每个 RSS 条目都有一些描述内容

## 示例

### 之前（仅元描述）
```xml
<description>文章的简短元描述。</description>
```

### 之后（使用内容提取）
```xml
<description><![CDATA[
<p>本文讨论了 RSS 订阅源在现代内容分发中的重要性。RSS 为用户提供了订阅网站更新的标准化方式，并在发布新内容时接收通知。</p>

<p>该格式多年来不断发展，支持更丰富的内容，包括 HTML 格式和多媒体元素...</p>

<p><a href="https://example.com/article">阅读更多...</a></p>
]]></description>
```

## 优势

### 对内容创作者
- ✅ 为原网站导流
- ✅ 提供内容预览而不泄露完整文章
- ✅ 保持原内容的 SEO 价值
- ✅ 在改善 RSS 体验的同时尊重版权

### 对 RSS 读者
- ✅ 更丰富的内容预览
- ✅ 更好地决定要阅读哪些文章
- ✅ 改善 RSS 客户端中的阅读体验
- ✅ 清晰的完整文章访问路径

## 向后兼容性

新功能完全向后兼容：
- 现有 RSS 订阅源继续正常运行
- RSS 结构或部署过程无破坏性更改
- 内容提取默认启用，但可以禁用

## 最佳实践

### 内容长度
- **新闻网站**: 提取所有可用内容用于快速浏览
- **博客文章**: 提取所有段落以提供有意义的预览  
- **技术文章**: 提取完整内容以提供上下文

### 选择性启用
可以通过在流程调用中设置 `extract_content=False` 来禁用特定站点的内容提取功能。

### 监控
监控 RSS 订阅源生成日志，确保内容提取正常工作。

## 故障排除

### 常见问题

**内容提取失败**: 
- 检查网站是否阻止自动化请求
- 验证网站结构是否使用语义 HTML
- 考虑调整内容选择器

**内容质量差**:
- 检查网站是否有特殊的 HTML 结构
- 系统会回退到元描述

**性能影响**:
- 内容提取需要额外的 HTTP 请求
- 如果订阅源生成时间过长，考虑减少 `max_items`
- 在 RSS 生成期间监控服务器资源

### 日志消息
查看这些日志消息了解发生的情况：
- `"获取页面内容: {url}"` - 开始内容提取
- `"内容提取失败: {error}"` - 内容提取失败
- `"创建了 {count} 个 RSS 条目"` - RSS 生成完成

## 实现细节

### 修改的文件
- `lib/rss_generator.py`: 增强的 RSS 生成，支持 CDATA
- `flows/sitemap_to_rss.py`: 添加内容提取功能
- `lib/content_extractor.py`: 新增的内容提取模块

### 添加的依赖
- `beautifulsoup4`: 用于 HTML 解析和内容提取

此增强使 RSS 订阅源对内容创作者和读者都更有价值，同时保持现有系统的简单性和可靠性。