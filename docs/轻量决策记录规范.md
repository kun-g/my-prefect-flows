DECISIONS.md 轻量决策记录规范

仅针对 DECISIONS.md 本身；完整 ADR 规范已另行维护。
目标：极低记录成本 + 足够可追溯，服务个人/小团队快速回忆与演进。

⸻

1. 文件位置与命名

/project-root
└─ DECISIONS.md   # 单一 Markdown 文件，追加式编辑

	•	始终放在仓库根目录，避免分散。
	•	一条决策 ≠ 一行，但务必 ≤ 12 行；超出即考虑升级为 ADR。

⸻

2. 触发条件（何时写）

命中 任意一条 即应记录：
	1.	思考时间 ≥ 30 分钟
	2.	预期影响 ≥ 3 个月
	3.	回滚/重构代价 ≥ 5 小时
	4.	未来自己可能忘记「为什么」的判断

口令：“再想一次会更费时吗？”——如果是，就写下。

⸻

3. 条目模板（MarkDown 段落）

### 2025-07-14 使用 SQLite 作为本地缓存
- **Decision**: JSON 文件 → SQLite (WAL)
- **Reason**: 查询 O(N²) + 写冲突；SQLite 内置锁与索引
- **Alternatives**: JSON + 内存索引 / Postgres 容器化
- **Trade-offs**: 引入 schema 迁移；云端迁移脚本成本

字段说明

字段	说明	必填	建议长度
Date + Title	### YYYY-MM-DD <简洁标题>	✅	≤ 1 行
Decision	具体选型/方案	✅	1 – 2 行
Reason	关键动机/约束	✅	1 – 3 行
Alternatives	至少 1 种被拒方案	⭕️	1 – 3 行
Trade-offs	正负面影响/成本	⭕️	1 – 3 行

可选字段可省略；必要时追加 Impact、Follow-up 等小节，仍须保持总长度 ≤ 12 行。

⸻

4. 提交流程
	1.	记录：在 DECISIONS.md 末尾粘贴模板并填充。
	2.	代码提交（同一个 commit）：

feat(cache): switch to SQLite

Refs: DEC-20250714-sqlite

	•	DEC-YYYYMMDD-keyword：保证 Git 日志可直接 grep 到决策。
	•	若同时关联 Issue/PR，照常 closes #123，二者不冲突。

	3.	评审（可选）：自查是否遗漏替代方案或负面影响。

⸻

5. 维护规则

情况	操作
假设失效	在原条目末尾追加 — ⚠ Deprecated YYYY-MM-DD
内容膨胀（> 12 行或多次补丁）	升级为 ADR：① 用 ADR 模板新建 docs/adr/NNN-*.md② 在旧条目尾部写 — Superseded by ADR-NNN
重复主题条目 ≥ 3	合并为新 ADR，旧条目标 Merged

原则：正文只增不改，用追加标记维护演进轨迹。

⸻

6. 快速命令（示例）

# 创建新条目脚本 ~/bin/new_decision.sh
d=$(date +%Y-%m-%d)
echo -e "### $d <标题待填>\n- **Decision**:\n- **Reason**:\n" >> DECISIONS.md


⸻

7. 最佳实践
	1.	写在做之前：决策先落笔，可倒逼思考更清晰。
	2.	保持对称：Decision ↔ Reason ↔ Trade-offs 行数大致平衡，防止偏颇。
	3.	避免行话：假设半年后的自己是“新人”；描述要去术语化。
	4.	季度回顾：每 3 个月浏览 DECISIONS.md，标记失效或升级候选。

⸻

结论

DECISIONS.md 是 个人级“技术日记”：
	•	足够轻：一分钟写完，不中断开发节奏。
	•	足够深：半年后能迅速回溯“当时为什么”。
	•	足够久：配合 Refs: 与 Git 历史，随时离线检索。

按此规范执行，即可在 最小投入 下获得 最大认知回报。